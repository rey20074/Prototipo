/*
Página principal para la aplicación de hospitales
Andrea Lam, 20102
Mariano Reyes. 20074
Ultima Modificación:
06/10/2020

*/

import java.util.Scanner;
import com.opencsv.*;
import org.apache.poi.openxml4j.exceptions.InvalidFormatException;

import java.io.*;
import java.io.IOException;
import java.util.ArrayList;


/*
Página principal para la aplicación de hospitales
Andrea Lam, 20102
Mariano Reyes. 20074
Ultima Modificación:
06/10/2020

*/

import java.util.Scanner;
import com.opencsv.*;
import org.apache.poi.openxml4j.exceptions.InvalidFormatException;

import java.io.*;
import java.io.IOException;
import java.util.ArrayList;


public class driver {

    public static void main( String[] args) throws IOException, InvalidFormatException {

        Scanner scan = new Scanner(System.in);
        int contador=0;
        boolean bandera=false,bandera2=false;
        //verificar v = new verificar();
        ArrayList<String> usuarios = new ArrayList<String>();
        ArrayList<String> contrasenas = new ArrayList<String>();

        vista v=new vista();

        v.bienvenida();
        String correo = v.datos("Usuario");
        System.out.println(correo);
        String contra = v.datos("Contraseña");
        System.out.println(contra);

        int opcion=0;
        int opcionhosp=0;

        //buscar el usuario en el csv
        FileReader archCSV = null;
        CSVReader csvReader = null;

        try {
            //Leo el archivo con el separador estándar ","
            archCSV = new FileReader("archivos/usuarios.csv");
            csvReader = new CSVReader(archCSV);
            String[] fila = null;
            while((fila = csvReader.readNext()) != null) {
                usuarios.add(fila[0]);
                contrasenas.add(fila[1]);
            }
        }
        catch(IOException e) {
            System.out.println(e);
        }
        catch(Exception e) {
            System.out.println(e);
        }

        finally {
            try {
                archCSV.close();
                csvReader.close();
            }
            catch(IOException e) {
                System.out.println(e);
            }
        }
        //Guardados usarios y contraseñas

        //verificar si existe el usuario
        for(int i=0; i<usuarios.size();i++)
        {
            //System.out.println(usuarios.get(i));
            //System.out.println(contrasenas.get(i));
            if(usuarios.get(i).equals(correo) && contrasenas.get(i).equals(contra))
            {
                bandera=true;
            }
            //System.out.println(bandera);
        }
        if(bandera==true)//existe el usuario
        {
            v.mensaje("Usuario si existe");
        }
        if(bandera==false)// crear usuario
        {
            v.mensaje("Usuario no existente, procediendo a registrar\n");
            String usuario = v.datos("Usuario con el que se desea ingresar: ");
            //verifica si el usuario ingresado existe o no
            for (int i = 0; i < usuarios.size(); i++) {
                while (usuarios.get(i).equals(usuario)) {
                    bandera2 = true; //ya existe
                    v.mensaje("Usuario existente, porfavor ingrese otro correo");
                    //JOptionPane.showMessageDialog(null, "Usuario existente, porfavor ingrese otro correo");
                    usuario = v.datos("Correo con el que se desea ingresar: ");
                    int a = 0;


                }
            }

            String contrat = v.datos("Constraseña que desee: ");
            usuarios.add(usuario);
            contrasenas.add(contrat);

            /*String archCSV1 = "archivos/usuarios.csv";
            CSVWriter writer = new CSVWriter(new FileWriter(archCSV1));
            ArrayList<String> temporal = new ArrayList<String>();
            for(int w=0; w<usuarios.size(); w++)
            {

               temporal.add(usuarios.get(w)+","+contrasenas.get(w));
            }

            for(int w=0; w<usuarios.size(); w++)
            {
                writer.writeNext(temporal);
            }
            writer.close();
            
            otro tipo de idea
            
            //añade el nuevo usuario a la base de datos
            String archCSV1 = "archivos/usuarios.csv"; //busca el archivo
            CSVWriter writer = new CSVWriter(new FileWriter(archCSV1)); //abre el writer
            ArrayList<String> temporal = new ArrayList<String>(); //donde estaran los usuarios y contrasenas

            for(int w=0; w<usuarios.size(); w++)
            {

                temporal.add(usuarios.get(w)+","+contrasenas.get(w));
            }

            for(int w=0; w<usuarios.size(); w++)
            {
                writer.writeNext((String[])temporal.toArray());
            }

            writer.close(); */

        }


        while(opcion!=4){
            opcion = v.opciones("¿A donde desea ingresar?\n1. Hospitales \n2. Atención Medica \n3. Materiales\n4. Salir",4);
            if(opcion==1)//Hospitales
            {
                Hospitales hosp=new Hospitales();
                //leer archivo lee el csv y almacena las columnas en arraylist
                hosp.leerArchivo();
                //la conversion crea arraylists Ints de las Strings que son de numeros
                hosp.conversionInt();

                while(opcionhosp != 3){
                    opcionhosp =v.opciones("¿A donde desea ingresar?\n1. Mostrar toda la informacion necesaria \n2. Recomendar Hospital \n3. Regresar",3);
                    if(opcionhosp==1){
                        //mostrartodo muestra esas variables impresas
                        hosp.mostrarTodo();
                    }
                    else if(opcionhosp==2){
                        //este metodo es donde se muestra el mejor hospital por el numero de camas disponibles y el peor tambien
                        hosp.cola();
                    }
                    else if(opcionhosp==3){
                        v.mensaje("Eligio regresar...");
                    }
                    else{
                        v.mensaje("Porfavor ingrese solo una opcion del 1 al 3");
                    }
                }

                //en este metodo se aleatorizan las camas ocupadas de cada hospital sin pasasrse del limite de camas totales
                hosp.camasAleatorias();
            }
            else if(opcion==2)//Atención Medica
            {
                //Instanciamos la clase Atencion Medica
                AtencionMedica at = new AtencionMedica();
                //Mandamos a llamar a ala clase Atención Medica
                at.Imprimir();

            }else if(opcion==3)//Materiales
            {
                ArrayList<Item> item = new ArrayList<Item>();
                int opcionm = 1;
                int contadorm = 1;

                var scanm = new Scanner(System.in);

                while (opcionm == 1)
                {
                    Item detalle = new Item();
                    ArrayList<Item> listado = new ArrayList<Item>();
                    detalle.setNombre(v.datos("Ingres el nombre del producto"));
                    detalle.setCantidadActual(v.numero("Ingres la cantidad actual"));
                    detalle.setCantidadFalta(v.numero("Ingres la cantidad que falta"));

                    v.mensaje("Desea seguir agregando productos");
                    opcionm = v.opciones("Ingrese 1 si desea continuar, 2 para terminar de escribir",2);

                    listado.add(detalle);
                    item.addAll(0, listado);
                    contadorm++;
                }

                materiales m = new materiales();

                m.crearExcel(item);
            }
            else if(opcion==4)//Salir
            {
                v.mensaje("Pase buen día.");
            }
            else
            {
                v.mensaje("Porfavor ingrese solo una opcion del 1 al 4");
            }
        }

    }
}
